name: Pack and Release

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version'
        required: true
        default: '0.0.0'
  push:
    tags:
      - "*"

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v2

    - run: echo "Deploying to production server on branch $GITHUB_REF"

    - name: set version from workflow_dispatch
      if: github.event_name == 'workflow_dispatch'
      env:
        VERSION: "${{ github.event.inputs.version }}"
      run: echo "${VERSION}"

    - name: set version from tag
      if: startsWith(github.ref, 'refs/tags/')
      env:
        VERSION: "${{ github.ref }}"
      run: echo "${VERSION}"

#    - name: ref...
#      run: echo "${{GITHUB_REF}}"
#    - name: Set VERSION variable from tag
#      run: echo "VERSION=${GITHUB_REF/refs\/tags\/release\-/}" >> $GITHUB_ENV
#    - name: Set VERSION variable from tag
#      run: echo '::set-output name=VERSION::$(echo ${GITHUB_REF})'      
#    - name: Setup .NET
#      uses: actions/setup-dotnet@v1
#      with:
#        dotnet-version: 5.0.x

#    - name: Build
#      run: dotnet build ./src/ --configuration release /p:Version=${VERSION}
#    - name: Test
#      run: dotnet test ./src/ --configuration release /p:Version=${VERSION} --no-build
#    - name: Pack
#      run: dotnet pack ./src/ --configuration release /p:Version=${VERSION} --no-build --output .
#    - name: Push
#      run: dotnet nuget push NuGet.Workflow.${VERSION}.nupkg --source https://api.nuget.org/v3/index.json --api-key ${{ secrets.NUGET_API_KEY }}
